[General]
abstract = true
image-path = ../../../images
output-scalar-file-append = false
sim-time-limit = 20s
warmup-period = 1s
seed-set = ${repetition}

debug-on-errors = false

############### Statistics ##################
result-dir = results
output-scalar-file = ${resultdir}/${configname}/${iterationvars}-${repetition}.sca
output-vector-file = ${resultdir}/${configname}/${iterationvars}-${repetition}.vec

**.vector-recording = false
**.sctp.**.scalar-recording = false
**.sctp.**.vector-recording = false
**.routingRecorder.enabled = false

############### SCTP configuration ##################
**.sctp.nagleEnabled = false
**.sctp.enableHeartbeats = true

############### Floorplan definition #################
**.mobility.constraintAreaMaxX = 1000m
**.mobility.constraintAreaMaxY = 700m
**.mobility.constraintAreaMinX = 0m
**.mobility.constraintAreaMinY = 250mm
**.mobility.constraintAreaMinZ = 0m
**.mobility.constraintAreaMaxZ = 0m
**.mobility.initFromDisplayString = false

############### IPv4 configurator config #################
*.configurator.config = xmldoc("./demo.xml")

############### General PHY parameters ##############
**.downlinkInterference = true
**.uplinkInterference = true
**.fading = false
**.shadowing = false
**.targetBler = 0.01
**.blerShift = 5

#------------------------------------#
# Config MultiCell
#
# Base configuration for multicell 5G standalone deployment
#
[Config MultiCell]
network = simu5g.simulations.nr.handover_sim.MultiCell_Standalone
description = "Base configuration for multicell NR standalone deployment"
abstract = true

############### General PHY parameters ##############
**.downlinkInterference = true
**.uplinkInterference = true
**.ueTxPower = 20dBm
**.eNodeBTxPower = 20dBm
**.targetBler = 0.01
**.blerShift = 5
**.fbPeriod = 40tti   # reports CQI every 40ms

############# Floorplan parameters ################
**.mobility.constraintAreaMaxX = 1000m
**.mobility.constraintAreaMaxY = 750m
**.mobility.constraintAreaMinX = 0m
**.mobility.constraintAreaMinY = 250m
**.mobility.constraintAreaMinZ = 0m
**.mobility.constraintAreaMaxZ = 0m
**.mobility.initFromDisplayString = false

############### Carrier Aggregation #################
*.carrierAggregation.numComponentCarriers = 1
*.carrierAggregation.componentCarrier[0].numerologyIndex = ${u=0}
*.carrierAggregation.componentCarrier[0].carrierFrequency = 2GHz
*.carrierAggregation.componentCarrier[0].numBands = ${numRbs=50}

*.gnb*.cellularNic.numCarriers = 1
*.gnb*.cellularNic.channelModel[0].componentCarrierModule = "carrierAggregation.componentCarrier[0]"
*.ue[*].cellularNic.numCarriers = 1
*.ue[*].cellularNic.nrChannelModel[0].componentCarrierModule = "carrierAggregation.componentCarrier[0]"

############### BS position #################
*.gnb1.mobility.initialX = 250m
*.gnb1.mobility.initialY = 500m
*.gnb2.mobility.initialX = 750m
*.gnb2.mobility.initialY = 500m

############### X2 configuration #################
*.gnb*.numX2Apps = 1
*.gnb*.x2App[*].server.localPort = 5000 + ancestorIndex(1)
*.gnb1.x2App[0].client.connectAddress = "gnb2%x2ppp0"
*.gnb2.x2App[0].client.connectAddress = "gnb1%x2ppp0"

############## UE configuration ##################
**.dynamicCellAssociation = true
**.enableHandover = true
*.ue[*].macCellId = 0
*.ue[*].masterId = 0
*.ue[*].nrMacCellId = 1
*.ue[*].nrMasterId = 1

#------------------------------------#
# UDP configuration for multicell handover
#
[Config Multicell-Handover-UDP]
extends = MultiCell
description = "UDP-based multicell handover simulation"

############## UE configuration ##################
# UE count
*.numUe = ${numUEs=10..100 step 10}

############## UE position and direction ##################
*.ue[*].mobility.typename = "LinearMobility"
*.ue[*].mobility.updateInterval = 0s
*.ue[*].mobility.initFromDisplayString = false
*.ue[*].mobility.speed = 25mps  # 25m/s, moves between gNBs within 20s

# alternate UE start positions (even/odd)
*.ue[*].mobility.initialX = (ancestorIndex(1)%2==1) ? uniform(240m,260m) : uniform(740m,760m)
*.ue[*].mobility.initialY = uniform(490m,510m)
*.ue[*].mobility.initialMovementHeading = (ancestorIndex(1)%2==1) ? 0deg : 180deg

############## Application configuration ##################
# Receiver on each UE
*.ue[*].numApps = 1
*.ue[*].app[0].typename = "simu5g.apps.filetransfer_multicell.FileReceiverUDP"
*.ue[*].app[0].localPort = 5000 + ancestorIndex(1)

# Server sends to each UE
*.server.numApps = ${numUEs}
*.server.app[*].typename = "simu5g.apps.filetransfer_multicell.FileSenderUDP"
*.server.app[*].destAddress = "ue[" + string(ancestorIndex(0)) + "]"
*.server.app[*].destPort = 5000 + ancestorIndex(0)
*.server.app[*].localPort = 3088 + ancestorIndex(0)

# Simulation control
*.server.app[*].nFrames = 2000
*.server.app[*].payloadSize = ${ps=100..1000 step 100}B
*.server.app[*].samplingTime = 0.02s
*.server.app[*].startTime = uniform(1.10s, 1.20s)

############## Output ##################
output-scalar-file = results/UDP/${configname}-${repetition}.sca
output-vector-file = results/UDP/${configname}-${repetition}.vec 

[Config Multicell-Handover-TCPIP]
extends = MultiCell
description = "TCP/IP-based multicell handover simulation"
warmup-period = 1s

*.numUe = ${numUEs=10..100 step 10}

*.ue[*].numApps = 1
*.ue[*].app[0].typename = "simu5g.apps.filetransfer_multicell.FileReceiverTCP"
*.ue[*].app[0].localPort = 5000 + ancestorIndex(1)

*.server.numApps = ${numUEs}
*.server.app[*].typename = "simu5g.apps.filetransfer_multicell.FileSenderTCP"
*.server.app[*].destAddress = "ue[" + string(ancestorIndex(0)) + "]"
*.server.app[*].destPort = 5000 + ancestorIndex(0)
*.server.app[*].localPort = 3088 + ancestorIndex(0)

*.server.app[*].nFrames = 2000
*.server.app[*].payloadSize = ${ps=100..1000 step 100}B
*.server.app[*].samplingTime = 0.02s
*.server.app[*].startTime = uniform(1.1s, 1.2s)

output-scalar-file = results/TCPIP/${configname}-${repetition}.sca
output-vector-file = results/TCPIP/${configname}-${repetition}.vec

[Config Multicell-Handover-QUIC]
extends = MultiCell
description = "QUIC-based multicell handover simulation"

*.numUe = ${numUEs=10..100 step 10}

*.ue[*].numApps = 1
*.ue[*].app[0].typename = "simu5g.apps.filetransfer_multicell.FileReceiverQUIC"
*.ue[*].app[0].localPort = 5000 + ancestorIndex(1)

*.server.numApps = ${numUEs}
*.server.app[*].typename = "simu5g.apps.filetransfer_multicell.FileSenderQUIC"
*.server.app[*].destAddress = "ue[" + string(ancestorIndex(0)) + "]"
*.server.app[*].destPort = 5000 + ancestorIndex(0)
*.server.app[*].localPort = 3088 + ancestorIndex(0)

*.server.app[*].nFrames = 2000
*.server.app[*].payloadSize = ${ps=100..1000 step 100}B
*.server.app[*].samplingTime = 0.02s
*.server.app[*].startTime = uniform(1.2s, 1.3s)

output-scalar-file = results/QUIC/${configname}-${repetition}.sca
output-vector-file = results/QUIC/${configname}-${repetition}.vec 
